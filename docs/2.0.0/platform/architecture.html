<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SiteWhere Architecture | SiteWhere</title>
    <meta name="description" content="SiteWhere CE 2.0.0 Documentation">
    <link rel="icon" href="/docs/2.0.0/images/favicon.png">
    
    <link rel="preload" href="/docs/2.0.0/assets/css/0.styles.523cf4aa.css" as="style"><link rel="preload" href="/docs/2.0.0/assets/js/app.8847603b.js" as="script"><link rel="preload" href="/docs/2.0.0/assets/js/68.3a35764c.js" as="script"><link rel="prefetch" href="/docs/2.0.0/assets/js/23.588c3d85.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/2.51a7a63e.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/3.1a822c12.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/4.856fab00.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/5.b1805555.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/6.868dfd49.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/7.b502a43e.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/8.93dea270.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/9.f464343f.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/10.d9ddd5f6.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/11.9bea3060.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/12.76df2de7.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/13.7cee05b0.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/14.cf24155d.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/15.37b52925.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/16.46b16051.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/17.2d3e5162.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/18.d75c1c58.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/19.21043226.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/20.e78c4509.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/21.dd496b72.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/22.81471192.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/24.d6845b74.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/25.e7935013.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/26.14f38e79.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/27.20796f60.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/28.09f588e1.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/29.006ceecc.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/30.c9323ea3.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/31.c3344e46.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/32.b14bddbb.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/33.1b016a61.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/34.54f283e6.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/35.cc2cb199.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/36.9bf158ce.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/37.2ebda301.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/38.cc245218.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/39.992db8aa.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/40.e1fccad2.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/41.c7a8fa25.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/42.e8dc10e8.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/43.09f4fcbd.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/44.934161b9.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/45.cb11bca7.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/46.71e4a747.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/47.982327d8.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/48.7c2a4328.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/49.806a2a2f.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/50.077538ce.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/51.74f0ee87.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/52.5388990c.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/53.cdc07629.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/54.7b7e5a97.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/55.73133064.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/56.86fe5251.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/57.defb81ce.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/58.601d4465.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/59.a85e896f.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/60.b7183a1f.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/61.07d4c618.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/62.99338a61.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/63.6f6ee8fd.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/64.a2ab4165.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/65.ae2b71a2.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/66.207d06a5.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/67.0b8377dd.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/69.bd6da76a.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/70.62f9c85c.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/71.5af6f675.js"><link rel="prefetch" href="/docs/2.0.0/assets/js/72.df49808c.js">
    <link rel="stylesheet" href="/docs/2.0.0/assets/css/0.styles.523cf4aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/2.0.0/" class="home-link router-link-active"><img src="/docs/2.0.0/images/logo.svg" alt="SiteWhere" class="logo"></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/2.0.0/platform/" class="nav-link router-link-active">Platform</a></div><div class="nav-item"><a href="/docs/2.0.0/guide/" class="nav-link">User Guide</a></div><div class="nav-item"><a href="/docs/2.0.0/deployment/" class="nav-link">Deployment</a></div><div class="nav-item"><a href="/docs/2.0.0/development/" class="nav-link">Development</a></div><div class="nav-item"><a href="https://github.com/sitewhere/sitewhere" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/2.0.0/platform/architecture.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/docs/2.0.0/es/platform/architecture.html" class="nav-link">Español</a></li></ul></div></div> <a href="https://github.com/sitewhere/sitewhere-documentation" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/2.0.0/platform/" class="nav-link router-link-active">Platform</a></div><div class="nav-item"><a href="/docs/2.0.0/guide/" class="nav-link">User Guide</a></div><div class="nav-item"><a href="/docs/2.0.0/deployment/" class="nav-link">Deployment</a></div><div class="nav-item"><a href="/docs/2.0.0/development/" class="nav-link">Development</a></div><div class="nav-item"><a href="https://github.com/sitewhere/sitewhere" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/2.0.0/platform/architecture.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/docs/2.0.0/es/platform/architecture.html" class="nav-link">Español</a></li></ul></div></div> <a href="https://github.com/sitewhere/sitewhere-documentation" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/docs/2.0.0/platform/" class="sidebar-link">SiteWhere Platform</a></li><li><a href="/docs/2.0.0/platform/architecture.html" class="active sidebar-link">SiteWhere Architecture</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/2.0.0/platform/architecture.html#kubernetes" class="sidebar-link">Kubernetes</a></li><li class="sidebar-sub-header"><a href="/docs/2.0.0/platform/architecture.html#microservices" class="sidebar-link">Microservices</a></li><li class="sidebar-sub-header"><a href="/docs/2.0.0/platform/architecture.html#instance-management" class="sidebar-link">Instance Management</a></li><li class="sidebar-sub-header"><a href="/docs/2.0.0/platform/architecture.html#high-performance-data-processing-pipeline" class="sidebar-link">High Performance Data Processing Pipeline</a></li><li class="sidebar-sub-header"><a href="/docs/2.0.0/platform/architecture.html#persistent-api-connectivity-between-microservices" class="sidebar-link">Persistent API Connectivity Between Microservices</a></li><li class="sidebar-sub-header"><a href="/docs/2.0.0/platform/architecture.html#distributed-multitenancy" class="sidebar-link">Distributed Multitenancy</a></li></ul></li><li><a href="/docs/2.0.0/platform/features.html" class="sidebar-link">New Features</a></li><li><a href="/docs/2.0.0/platform/microservice-overview.html" class="sidebar-link">Microservices Overview</a></li><li><a href="/docs/2.0.0/platform/twelve-factor.html" class="sidebar-link">SiteWhere as a Twelve-Factor App</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="sitewhere-architecture"><a href="#sitewhere-architecture" aria-hidden="true" class="header-anchor">#</a> SiteWhere Architecture</h1> <p>SiteWhere has been designed from the ground up to take advantage of the latest
technologies in order to scale efficiently to the loads expected in large IoT
projects. Rather than using a monolithic architecture, SiteWhere embraces
a completely distributed architecture using <a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer">Kubernetes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
as the infrastructure and a variety of microservices to build out the system.
This approach allows customization and scaling at a fine-grained level
so that the system may be tailored to many potential IoT use cases. SiteWhere
is built with a framework approach using clearly defined APIs so that new
technologies may easily be integrated as the IoT ecosystem evolves.</p> <h2 id="kubernetes"><a href="#kubernetes" aria-hidden="true" class="header-anchor">#</a> Kubernetes</h2> <p>SiteWhere is composed of Java-based microservices which are built as
<a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">Docker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> images and deployed to Kubernetes for
orchestration. To simplify deployment, <a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is used to
provide standard templates for various deployment scenarios. Helm
<a href="https://github.com/sitewhere/sitewhere-recipes/tree/master/charts" target="_blank" rel="noopener noreferrer">charts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
supply all of the dependencies needed to run a complete SiteWhere
instance, including both the microservices and infrastructure
components such as Apache Zookeeper, Apache Kafka and Mosquitto MQTT broker.</p> <h2 id="microservices"><a href="#microservices" aria-hidden="true" class="header-anchor">#</a> Microservices</h2> <p>A SiteWhere <em>instance</em> is a distributed system composed of many microservices,
each of which serves a specific function and is completely decoupled from
the other services. The microservices use a service discovery mechanism to
self-assemble into a working system.</p> <h3 id="separation-of-concerns"><a href="#separation-of-concerns" aria-hidden="true" class="header-anchor">#</a> Separation of Concerns</h3> <p>Each microservice is a completely self-contained entity that has its
own configuration schema, internal components, data persistence, and
interactions with the event processing pipeline. SiteWhere microservices
are built on top of a custom microservice framework and run as separate
<a href="https://projects.spring.io/spring-boot/" target="_blank" rel="noopener noreferrer">Spring Boot<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> processes, each
contained in its own <a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">Docker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> image.</p> <p>Separating the system logic into microservices allows the interactions
between various areas of the system to be more clearly defined. This
transition has resulted in a more understandable and maintainable
system and should continue to pay dividends as more features are added.</p> <h3 id="scale-what-you-need-leave-out-what-you-don-t"><a href="#scale-what-you-need-leave-out-what-you-don-t" aria-hidden="true" class="header-anchor">#</a> Scale What You Need. Leave Out What You Don't</h3> <p>The microservice architecture allows individual functional areas of the system to be scaled
independently or left out completely. In use cases where REST processing tends to
be a bottleneck, multiple REST microservices can be run concurrently to handle the load.
Conversely, services such as presence management that may not be required can be left
out so that processing power can be dedicated to other aspects of the system.</p> <h2 id="instance-management"><a href="#instance-management" aria-hidden="true" class="header-anchor">#</a> Instance Management</h2> <p>The 2.0 architecture introduces the concept of a SiteWhere <em>instance</em>, which
allows the distributed system to act as a cohesive unit with some aspects
addressed at the global level. All of the microservices for a single SiteWhere
instance must be running on the same Kubernetes infrastucture, though the system
may be spread across tens or hundreds of machines to distribute the processing
load.</p> <h3 id="centralized-configuration-management-with-apache-zookeeper"><a href="#centralized-configuration-management-with-apache-zookeeper" aria-hidden="true" class="header-anchor">#</a> Centralized Configuration Management with Apache ZooKeeper</h3> <p>SiteWhere 2.0 moves system configuration to <a href="https://zookeeper.apache.org/" target="_blank" rel="noopener noreferrer">Apache ZooKeeper<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
which allows configuration management to be externalized and
made highly-available. ZooKeeper contains a hierarchical
structure which represents the configuration for one or more SiteWhere instances
and all of the microservices that are used to realize them.</p> <p>Each microservice has a direct connection to ZooKeeper and uses the
hierarchy to determine its configuration at runtime. Microservices listen for changes
to the configuration data and react dynamically to updates. No configuration
is stored locally within the microservice, which prevents problems with
keeping services in sync as system configuration is updated.</p> <h3 id="distributed-storage-with-rook-io"><a href="#distributed-storage-with-rook-io" aria-hidden="true" class="header-anchor">#</a> Distributed Storage with Rook.io</h3> <p>Since many of the system components such as Zookeeper, Kafka, and various
databases require access to persistent storage, SiteWhere 2.0 uses
<a href="https://rook.io/" target="_blank" rel="noopener noreferrer">Rook.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> within Kubernetes to supply distributed,
replicated block storage that is resilient to hardware failures while
still offering good performance characteristics. As storage and throughput
needs increase over time, new storage devices can be made available
dynamically. The underlying <a href="https://ceph.com/" target="_blank" rel="noopener noreferrer">Ceph<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> architecture
used by Rook.io can handle <em>exobytes</em> of data while allowing data
to be resilient to failures at the node, rack, or even datacenter level.</p> <h3 id="service-discovery-with-hashicorp-consul"><a href="#service-discovery-with-hashicorp-consul" aria-hidden="true" class="header-anchor">#</a> Service Discovery with HashiCorp Consul</h3> <p>With the dynamic nature of the microservices architecture, it is important
for microservices to be able to efficiently locate running instances of
the various other services they interact with. SiteWhere 2.0 leverages
<a href="https://www.consul.io/" target="_blank" rel="noopener noreferrer">Consul<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for service discovery. Each microservice
registers with Consul and provides a steady stream of updates to the
(potentially replicated) central store. As instances of microservices are
added or removed, SiteWhere dynamically adjusts connectivity to take
advantage of the available resources.</p> <h2 id="high-performance-data-processing-pipeline"><a href="#high-performance-data-processing-pipeline" aria-hidden="true" class="header-anchor">#</a> High Performance Data Processing Pipeline</h2> <p>The event processing pipeline in SiteWhere 2.0 has been completely redesigned and uses
<a href="https://kafka.apache.org/" target="_blank" rel="noopener noreferrer">Apache Kafka<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to provide a resilient, high-performance
mechanism for progressively processing device event data. Microservices can plug in to
key points in the event processing pipeline, reading data from well-known inbound topics,
processing data, then sending data to well-known outbound topics. External entites that
are interested in data at any point in the pipeline can act as consumers of the SiteWhere
topics to use the data as it moves through the system.</p> <h3 id="fully-asynchronous-pipeline-processing"><a href="#fully-asynchronous-pipeline-processing" aria-hidden="true" class="header-anchor">#</a> Fully Asynchronous Pipeline Processing</h3> <p>In SiteWhere 2.0, each outbound connector is a true Kafka consumer with its own offset
marker into the event stream. This mechanism allows for outbound processors to process data
at their own pace without slowing down other processors. It also allows services to
leverage Kafka's consumer groups to distribute load across multiple consumers and
scale processing accordingly.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>In the SiteWhere 1.x architecture, the pipeline for outbound processing used a blocking
approach which meant that any single outbound processor could block the outbound pipeline.
This is no longer an issue with the 2.0 architecture.</p></div> <p>Using Kafka also has other advantages that are leveraged by SiteWhere. Since all data for
the distributed log is stored on disk, it is possible to &quot;replay&quot; the event stream based
on previously gathered data. This is extremely valuable for aspects such as debugging
processing logic or load testing the system.</p> <h2 id="persistent-api-connectivity-between-microservices"><a href="#persistent-api-connectivity-between-microservices" aria-hidden="true" class="header-anchor">#</a> Persistent API Connectivity Between Microservices</h2> <p>While device event data generally flows in a pipeline from microservice to microservice on
Kafka topics, there are also API operations that need to occur in real time between the
microservices. For instance, device management and event management functions are contained in
separate microservices, so as new events come in to the system, the inbound processing microservice
needs to interact with device management to look up existing devices in the system and event
management in order to persist the events to a datastore such as
<a href="http://cassandra.apache.org/" target="_blank" rel="noopener noreferrer">Apache Cassandra<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="using-grpc-for-a-performance-boost"><a href="#using-grpc-for-a-performance-boost" aria-hidden="true" class="header-anchor">#</a> Using gRPC for a Performance Boost</h3> <p>Rather than solely using REST services based on HTTP 1.x, which tend to have significant
connection overhead, SiteWhere 2.0 uses <a href="https://grpc.io/" target="_blank" rel="noopener noreferrer">gRPC<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to establish a long-lived
connection between microservices that need to communicate with each other. Since gRPC uses
persistent HTTP2 connections, the overhead for interactions is greatly reduced, allowing
for decoupling without a significant performance penalty.</p> <p>The entire SiteWhere <a href="https://github.com/sitewhere/sitewhere-java-api" target="_blank" rel="noopener noreferrer">data model<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> has been captured in
<a href="https://developers.google.com/protocol-buffers/" target="_blank" rel="noopener noreferrer">Google Protocol Buffers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> format so that
it can be used within GRPC services. All of the SiteWhere APIs are now exposed directly as
gRPC services as well, allowing for high-performance, low-latency access to what was previously
only accessible via REST. The REST APIs are still made available via the Web/REST microservice,
but they use the <a href="https://github.com/sitewhere/sitewhere-grpc-api" target="_blank" rel="noopener noreferrer">gRPC APIs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> underneath
to provide a consistent approach to accessing data.</p> <p>Since the number of instances of a given microservice can change over time as the service is
scaled up or down, SiteWhere automatically handles the process of connecting/disconnecting the
gRPC pipes between microservices. Each outbound gRPC client is demulitplexed across the pool
of services that can satisfy the requests, allowing the requests to be processed in parallel.</p> <h2 id="distributed-multitenancy"><a href="#distributed-multitenancy" aria-hidden="true" class="header-anchor">#</a> Distributed Multitenancy</h2> <p>The SiteWhere 1.x approach to multitenancy was to use a separate &quot;tenant engine&quot; for each tenant.
The engine supported all tenant-specific tasks such as data persistence, event processing, etc.
Since SiteWhere 2.0 has moved to a microservices architecture, the multitenant model has been
distributed as well. SiteWhere supports two types of microservices: global and multitenant.</p> <h3 id="global-microservices"><a href="#global-microservices" aria-hidden="true" class="header-anchor">#</a> Global Microservices</h3> <p>Global microservices do not handle tenant-specific tasks. These services handle aspects such
as instance-wide user management and tenant management that are not specific to individual
system tenants. The Web/REST microservice that supports the REST services and Swagger user
interface is also a global service, since supporting a separate web container for each tenant
would be cumbersome and would break existing SiteWhere 1.x applications. There is also a
global instance management microservice that monitors various aspects of the entire instance
and reports updates to the individual microservces via Kafka.</p> <h3 id="multitenant-microservices"><a href="#multitenant-microservices" aria-hidden="true" class="header-anchor">#</a> Multitenant Microservices</h3> <p>Most of the SiteWhere 2.0 services are multitenant microservices which delegate traffic
to tenant engines that do the actual processing. For instance, the inbound processing microservice
actually consists of many inbound processing tenant engines, each of which is configured separately
and can be started/stopped/reconfigured without affecting the other tenant engines.</p> <p>The new approach to tenant engines changes the dynamics of SiteWhere event processing. It is now
possible to stop a single tenant engine without the need for stopping tenant engines running in
other microservices. For instance, inbound processing for a tenant can be stopped
and reconfigured while the rest of the tenant pipeline continues processing. Since new
events can be allowed to stack up in Kafka, the tenant engine can be stopped, reconfigured,
and restarted, then resume where it left off with no data loss.</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/sitewhere/sitewhere-documentation/edit/master/docs/platform/architecture.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">12/17/2018, 12:09:28 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docs/2.0.0/platform/" class="prev router-link-active">
          SiteWhere Platform
        </a></span> <span class="next"><a href="/docs/2.0.0/platform/features.html">
          New Features
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/docs/2.0.0/assets/js/68.3a35764c.js" defer></script><script src="/docs/2.0.0/assets/js/app.8847603b.js" defer></script>
  </body>
</html>
