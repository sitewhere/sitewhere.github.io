(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{330:function(e,a,t){"use strict";t.r(a);var s=t(1),r=Object(s.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"content"},[e._m(0),e._v(" "),t("Seo"),e._v(" "),t("p",[e._v("Este documento proporciona procedimientos para realizar copias de seguridad y restaurar servicios que utilizan\nalmacenamiento persistente, incluidos MongoDB y Apache Zookeeper.")]),e._v(" "),e._m(1),e._v(" "),e._m(2),e._v(" "),e._m(3),e._v(" "),e._m(4),e._m(5),e._v(" "),e._m(6),t("p",[e._v("Guarde el archivo y aplíquelo al clúster.")]),e._v(" "),e._m(7),e._m(8),e._v(" "),e._m(9),e._m(10),e._v(" "),e._m(11),e._m(12),e._v(" "),e._m(13),e._m(14),e._m(15),e._v(" "),e._m(16),e._m(17),e._v(" "),e._m(18),e._m(19),e._v(" "),e._m(20),e._v(" "),e._m(21),e._m(22),e._v(" "),e._m(23),e._v(" "),e._m(24),e._m(25),e._v(" "),e._m(26),e._v(" "),e._m(27),e._m(28),e._v(" "),e._m(29),e._v(" "),e._m(30),e._m(31),e._v(" "),e._m(32),e._v(" "),e._m(33),e._m(34),e._v(" "),e._m(35)],1)}),[function(){var e=this.$createElement,a=this._self._c||e;return a("h1",{attrs:{id:"procedimientos-de-copias-de-seguridad-y-restauracion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#procedimientos-de-copias-de-seguridad-y-restauracion","aria-hidden":"true"}},[this._v("#")]),this._v(" Procedimientos de Copias de Seguridad y  Restauración")])},function(){var e=this.$createElement,a=this._self._c||e;return a("h2",{attrs:{id:"procedimiento-de-copias-de-seguridad"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#procedimiento-de-copias-de-seguridad","aria-hidden":"true"}},[this._v("#")]),this._v(" Procedimiento de Copias de Seguridad")])},function(){var e=this.$createElement,a=this._self._c||e;return a("h3",{attrs:{id:"crear-pvc-de-copia-de-seguridad"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#crear-pvc-de-copia-de-seguridad","aria-hidden":"true"}},[this._v("#")]),this._v(" Crear PVC de Copia de Seguridad")])},function(){var e=this.$createElement,a=this._self._c||e;return a("p",[this._v("Si planea usar el almacenamiento "),a("code",[this._v("rook-ceph-block")]),this._v(" storageClass ejecute:")])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubectl apply -f utils/sitewhere-mongodb-dump-pvc-rook.yaml\n")])])])},function(){var e=this.$createElement,a=this._self._c||e;return a("p",[this._v("Si planea utilizar un servidor NFS externo, edite el archivo\n"),a("code",[this._v("utils / sitewhere-mongodb-dump-pvc-nfs.yaml")]),this._v(", modifique la URL y Path del servidor NFS.")])},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("nfs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" <NFS_SERVER_IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<NFS_SERVER_PATH>"')]),e._v("\n")])])])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubectl apply -f utils/sitewhere-mongodb-dump-pvc-nfs.yaml\n")])])])},function(){var e=this.$createElement,a=this._self._c||e;return a("h3",{attrs:{id:"desescalar-microservicios-de-sitewhere"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#desescalar-microservicios-de-sitewhere","aria-hidden":"true"}},[this._v("#")]),this._v(" Desescalar Microservicios de SiteWhere")])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubectl scale deploy --replicas"),a("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("0 -l sitewhere.io/role"),a("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("microservice\n")])])])},function(){var e=this.$createElement,a=this._self._c||e;return a("h3",{attrs:{id:"copia-de-seguridad-de-base-de-datos-mongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copia-de-seguridad-de-base-de-datos-mongodb","aria-hidden":"true"}},[this._v("#")]),this._v(" Copia de seguridad de Base de Datos MongoDB")])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubectl apply -f utils/sitewhere-mongodb-dump-job.yaml\n")])])])},function(){var e=this.$createElement,a=this._self._c||e;return a("p",[this._v("Espere a que se complete el trabajo "),a("code",[this._v("sitewhere-mongodump")]),this._v(".")])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubectl get job\n")])])])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("NAME                  DESIRED   SUCCESSFUL   AGE\nsitewhere-mongodump   1         1            7s\n")])])])},function(){var e=this.$createElement,a=this._self._c||e;return a("p",[this._v("Alternativamente, puede crear un "),a("code",[this._v("CronJob")]),this._v(" que ejecutará el trabajo de copia de seguridad repetidamente. Puede\ncrear el "),a("code",[this._v("CronJob")]),this._v(" ejecutando:")])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubectl apply -f utils/sitewhere-mongodb-dump-crojob.yaml\n")])])])},function(){var e=this.$createElement,a=this._self._c||e;return a("p",[this._v("Por defecto, ejecutará un trabajo de respaldo una vez al día, a las "),a("code",[this._v("12: 01")]),this._v(". Puede cambiar este comportamiento\ncambiando la expresión de cron ("),a("code",[this._v("schedule")]),this._v(") en "),a("code",[this._v("utils/sitewhere-mongodb-dump-crojob.yaml")])])},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" batch/v1beta1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" CronJob\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" sitewhere"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("mongodump\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("schedule")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"*/1 * * * *"')]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("jobTemplate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n")])])])},function(){var e=this.$createElement,a=this._self._c||e;return a("h3",{attrs:{id:"copiar-datos-de-copia-de-seguridad-fuera-del-cluster"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copiar-datos-de-copia-de-seguridad-fuera-del-cluster","aria-hidden":"true"}},[this._v("#")]),this._v(" Copiar datos de copia de seguridad fuera del clúster")])},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("p",[e._v("Si está utilizando  "),t("code",[e._v("rook-ceph-block")]),e._v(" storage class "),t("code",[e._v("PVC")]),e._v(", es posible que deba extraer el archivo de copia de\nseguridad de Kubernates. Para llevar a cabo esta tarea, proporcionamos un "),t("code",[e._v("YAML")]),e._v(" que crea un "),t("code",[e._v("Pod")]),e._v(" que monta\nel "),t("code",[e._v("PVC")]),e._v(" utilizado para almacenar el resultado de la copia de seguridad. Después de crear el Pod, puede extraer\nlos archivos usando el comando "),t("code",[e._v("kubectl cp")]),e._v(". Los siguientes comandos muestran cómo extraer el resultado de la\ntrabajo de respaldo / cronjob.")])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubectl apply -f utils/sitewhere-mongodb-backup-pod.yaml\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[this._v("cp")]),this._v(" sitewhere-backup-admin-pod:/dump "),a("span",{pre:!0,attrs:{class:"token operator"}},[this._v("<")]),this._v("YOUR_BACKUP_DIR"),a("span",{pre:!0,attrs:{class:"token operator"}},[this._v(">")]),this._v("\nkubectl delete -f utils/sitewhere-mongodb-backup-pod.yaml\n")])])])},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("p",[t("strong",[e._v("Nota:")]),e._v(" Si está utilizando "),t("code",[e._v("rook-ceph-block")]),e._v(", tenga en cuenta la limitación "),t("code",[e._v("RWO")]),e._v(" de esta clase de almacenamiento.\nEsto significa que solo un "),t("code",[e._v("Pod")]),e._v(" puede tener el PVC "),t("code",[e._v("sitewhere-mongodump-pvc")]),e._v(" montado en su sistema de archivos.")])},function(){var e=this.$createElement,a=this._self._c||e;return a("h3",{attrs:{id:"escalar-microservicios-de-sitewhere"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#escalar-microservicios-de-sitewhere","aria-hidden":"true"}},[this._v("#")]),this._v(" Escalar Microservicios de SiteWhere")])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubectl scale deploy --replicas"),a("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("1 -l sitewhere.io/role"),a("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("microservice\n")])])])},function(){var e=this.$createElement,a=this._self._c||e;return a("h2",{attrs:{id:"procedimiento-de-restauracion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#procedimiento-de-restauracion","aria-hidden":"true"}},[this._v("#")]),this._v(" Procedimiento de Restauración")])},function(){var e=this.$createElement,a=this._self._c||e;return a("h3",{attrs:{id:"desescalar-microservicios-de-sitewhere-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#desescalar-microservicios-de-sitewhere-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Desescalar Microservicios de SiteWhere")])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubectl scale deploy --replicas"),a("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("0 -l sitewhere.io/role"),a("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("microservice\n")])])])},function(){var e=this.$createElement,a=this._self._c||e;return a("h3",{attrs:{id:"copiar-datos-de-copia-de-seguridad-en-el-cluster"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copiar-datos-de-copia-de-seguridad-en-el-cluster","aria-hidden":"true"}},[this._v("#")]),this._v(" Copiar datos de copia de seguridad en el Clúster")])},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("p",[e._v("Si está utilizando "),t("code",[e._v("rook-ceph-block")]),e._v(" storage class "),t("code",[e._v("PVC")]),e._v(", es posible que deba copiar el archivo\nde copia de seguridad en Kubernates. Para llevar a cabo esta tarea, proporcionamos un "),t("code",[e._v("YAML")]),e._v(" que crea un "),t("code",[e._v("Pod")]),e._v("\nque monta el "),t("code",[e._v("PVC")]),e._v(" utilizado para almacenar el resultado de la copia de seguridad. Después de crear el Pod,\npuede copiar los archivos usando el comando "),t("code",[e._v("kubectl cp")]),e._v(" en el clúster. Los siguientes comandos muestran cómo\ncopiar su archivo de copia de seguridad en el clúster.")])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubectl apply -f utils/sitewhere-mongodb-backup-pod.yaml\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[this._v("cp")]),this._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[this._v("<")]),this._v("YOUR_BACKUP_DIR"),a("span",{pre:!0,attrs:{class:"token operator"}},[this._v(">")]),this._v(" sitewhere-backup-admin-pod:/dump\nkubectl delete -f utils/sitewhere-mongodb-backup-pod.yaml\n")])])])},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("p",[t("strong",[e._v("Nota:")]),e._v(" Si está utilizando "),t("code",[e._v("rook-ceph-block")]),e._v(", tenga en cuenta la limitación"),t("code",[e._v("RWO")]),e._v(" de esta clase de\nalmacenamiento. Esto significa que solo un "),t("code",[e._v("Pod")]),e._v(" puede tener el PVC"),t("code",[e._v("sitewhere-mongodump-pvc")]),e._v(" montado en su\nsistema de archivos.")])},function(){var e=this.$createElement,a=this._self._c||e;return a("h3",{attrs:{id:"restaurar-la-base-de-datos-mongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#restaurar-la-base-de-datos-mongodb","aria-hidden":"true"}},[this._v("#")]),this._v(" Restaurar la base de datos MongoDB")])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubectl apply -f utils/sitewhere-mongodb-restore-job.yaml\n")])])])},function(){var e=this.$createElement,a=this._self._c||e;return a("h3",{attrs:{id:"escalar-microservicios-de-sitewhere-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#escalar-microservicios-de-sitewhere-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Escalar Microservicios de SiteWhere")])},function(){var e=this.$createElement,a=this._self._c||e;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubectl scale deploy --replicas"),a("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("1 -l sitewhere.io/role"),a("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("microservice\n")])])])}],!1,null,null,null);r.options.__file="backup-restore.md";a.default=r.exports}}]);