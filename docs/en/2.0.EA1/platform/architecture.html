

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SiteWhere Architecture &mdash; SiteWhere 2.0.EA1 Community Edition documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/css/sitewhere.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="SiteWhere 2.0.EA1 Community Edition documentation" href="../index.html"/>
        <link rel="up" title="SiteWhere Platform Introduction" href="index.html"/>
        <link rel="next" title="New Platform 2.0 Features" href="features.html"/>
        <link rel="prev" title="SiteWhere Platform Introduction" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> SiteWhere
          

          
          </a>

          
            
            
              <div class="version">
                2.0.EA1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">SiteWhere Platform Introduction</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">SiteWhere Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#microservices">Microservices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#separation-of-concerns">Separation of Concerns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scale-what-you-need-leave-out-what-you-don-t">Scale What You Need. Leave Out What You Don’t</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#instance-management">Instance Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-management-with-apache-zookeeper">Configuration Management with Apache ZooKeeper</a></li>
<li class="toctree-l3"><a class="reference internal" href="#event-processing-with-apache-kafka">Event Processing with Apache Kafka</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inter-microservice-communication-with-grpc">Inter-Microservice Communication with GRPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#distributed-multitenancy">Distributed Multitenancy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#global-microservices">Global Microservices</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multitenant-microservices">Multitenant Microservices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="features.html">New Platform 2.0 Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">SiteWhere Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment/index.html">SiteWhere Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userguide/index.html">SiteWhere User Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SiteWhere</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">SiteWhere Platform Introduction</a> &raquo;</li>
        
      <li>SiteWhere Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <a class="reference internal image-reference" href="../_images/sitewhere-with-tagline.png"><img alt="SiteWhere" class="align-center" src="../_images/sitewhere-with-tagline.png" style="width: 560.0px; height: 177.1px;" /></a>
<hr class="docutils" />
<div class="section" id="sitewhere-architecture">
<h1>SiteWhere Architecture<a class="headerlink" href="#sitewhere-architecture" title="Permalink to this headline">¶</a></h1>
<p>SiteWhere has been designed from the ground up to take advantage of the latest
technologies in order to scale efficiently to the loads expected in large IoT
projects. Rather than using a monolithic architecture, SiteWhere embraces
a completely distributed approach using microservices to allow scaling at the
component level so that the system may be tailored to the customer
use case. The system is built with a framework approach using clearly defined
APIs so that new technologies can easily be integrated as the IoT ecosystem
evolves. The remainder of this guide covers the core technologies used by
SiteWhere and how they fit together to build a comprehensive system.</p>
<div class="section" id="microservices">
<h2>Microservices<a class="headerlink" href="#microservices" title="Permalink to this headline">¶</a></h2>
<p>SiteWhere 2.0 introduces a much different architectural approach than was used
in the 1.x platform. While the core APIs are mostly unchanged, the system implementation
has moved from a monolithic approach to one based on microservices. This approach
provides a number of advantages over the previous architecture.</p>
<div class="section" id="separation-of-concerns">
<h3>Separation of Concerns<a class="headerlink" href="#separation-of-concerns" title="Permalink to this headline">¶</a></h3>
<p>Each microservice is a completely self-contained entity that has its
own unique configuration schema, internal components, data persistence,
and interactions with the event processing pipeline. SiteWhere microservices
are built on top of a custom microservice framework and run as separate
<a class="reference external" href="https://projects.spring.io/spring-boot/">Spring Boot</a> processes, each
contained in its own <a class="reference external" href="https://www.docker.com/">Docker</a> image.</p>
<p>Separating the system logic into microservices allows the interactions
between various areas of the system to be more clearly defined. This
transition has already resulted in a more understandable and maintainable
system and should continue to pay dividends as more features are added.</p>
</div>
<div class="section" id="scale-what-you-need-leave-out-what-you-don-t">
<h3>Scale What You Need. Leave Out What You Don’t<a class="headerlink" href="#scale-what-you-need-leave-out-what-you-don-t" title="Permalink to this headline">¶</a></h3>
<p>The microservice architecture allows individual functional areas of the system to be scaled
independently or left out completely. In use cases where REST processing tends to
be a bottleneck, multiple REST microservices can be run concurrently to handle the load.
Conversely, services such as presence management that may not be required can be left
out so that processing power can be dedicated to other aspects of the system.</p>
</div>
</div>
<div class="section" id="instance-management">
<h2>Instance Management<a class="headerlink" href="#instance-management" title="Permalink to this headline">¶</a></h2>
<p>The 2.0 architecture introduces the concept of a SiteWhere <em>instance</em>, which
allows the distributed system to act as a cohesive unit with some aspects
addressed at the global level. All of the microservices for a single SiteWhere
instance must be running on the same Docker infrastucture, though the system
can be spread across tens or hundreds of machines using technologies such as
<a class="reference external" href="https://github.com/docker/swarm">Docker Swarm</a> or <a class="reference external" href="https://kubernetes.io/">Kubernetes</a>.</p>
</div>
<div class="section" id="configuration-management-with-apache-zookeeper">
<h2>Configuration Management with Apache ZooKeeper<a class="headerlink" href="#configuration-management-with-apache-zookeeper" title="Permalink to this headline">¶</a></h2>
<p>SiteWhere 2.0 moves system configuration from the filesystem into
<a class="reference external" href="https://zookeeper.apache.org/">Apache ZooKeeper</a> to allow for a centralized,
coordinated approach to configuration management. ZooKeeper contains a
hierarchical structure which represents the configuration for a SiteWhere instance
and all of the microservices that are used to realize it.</p>
<p>Each microservice has a direct connection to ZooKeeper and uses the
hierarchy to determine information such as the instance it belongs to
and the configuration it should use. Microservices listen for changes to
the configuration data and react dynamically to updates. No configuration
is stored locally within the microservice, which prevents problems with
keeping services in sync as system configuration is updated.</p>
</div>
<div class="section" id="event-processing-with-apache-kafka">
<h2>Event Processing with Apache Kafka<a class="headerlink" href="#event-processing-with-apache-kafka" title="Permalink to this headline">¶</a></h2>
<p>The event processing pipeline in SiteWhere 2.0 has been completely redesigned and uses
<a class="reference external" href="https://kafka.apache.org/">Apache Kafka</a> to provide a resilient, high-performance
mechanism for progressively processing device event data. Each microservice plugs into
key points in the event processing pipeline, reading data from well-known inbound topics,
processing data, then sending data to well-known outbound topics. External entites that
are interested in data at any point in the pipeline can act as consumers of the SiteWhere
topics to use the data as it move through the system.</p>
<p>In the SiteWhere 1.x architecture, the pipeline for outbound processing used a blocking
approach which meant that any single outbound processor could block the outbound pipeline.
In SiteWhere 2.0, each outbound consumer is a true Kafka consumer with its own offset
marker into the event stream. This mechanism allows for outbound processors to process data
at their own pace without slowing down other processors.</p>
<p>Using Kafka also has other advantages that are leveraged by SiteWhere. Since all data for
the distributed log is stored on disk, it is possible to “replay” the event stream based
on previously gathered data. This is extremely valuable for aspects such as debugging
processing logic or load testing the system.</p>
</div>
<div class="section" id="inter-microservice-communication-with-grpc">
<h2>Inter-Microservice Communication with GRPC<a class="headerlink" href="#inter-microservice-communication-with-grpc" title="Permalink to this headline">¶</a></h2>
<p>While device event data generally flows in a pipeline from microservice to microservice on
Kafka topics, there are some operations that need to occur directly between microservices.
For instance, device management and event management persistence are each contained in
separate microservices, so as new events come in to the system, the inbound processing microservice
has to connect with the event persistence microservice to store the events. SiteWhere 2.0
uses <a class="reference external" href="https://grpc.io/">GRPC</a> to establish a long-lived connection between microservices
that need to communicate with each other. Since GRPC uses persistent HTTP2 connections,
the overhead for interactions is greatly reduced, allowing for decoupling without a
significant performance penalty.</p>
<p>The entire SiteWhere data model has been captured in
<a class="reference external" href="https://developers.google.com/protocol-buffers/">Google Protocol Buffers</a> format so that
it can be used within GRPC services. All of the SiteWhere APIs are now exposed directly as
GRPC services as well, allowing for high-performance, low-latency access to what was previously
only accessible via REST. The REST APIs are still made available via the Web/REST microservice,
but they use the GRPC APIs underneath to provide a consistent approach to accessing data.</p>
<p>Since the number of instances of a given microservice can change over time as the service is
scaled up or down, SiteWhere automatically handles the process of connecting/disconnecting the
GRPC pipes between microservices. Each outbound GRPC client is demulitplexed across the pool
of services that can satisfy the requests, allowing the requests to be processed in parallel.</p>
</div>
<div class="section" id="distributed-multitenancy">
<h2>Distributed Multitenancy<a class="headerlink" href="#distributed-multitenancy" title="Permalink to this headline">¶</a></h2>
<p>The SiteWhere 1.x approach to multitenancy was to use a separate “tenant engine” for each tenant.
The engine supported all tenant-specific tasks such as data persistence, event processing, etc.
Since SiteWhere 2.0 has moved to a microservices architecture, the multitenant model has been
distributed as well. SiteWhere supports two types of microservices: global and multitenant.</p>
<div class="section" id="global-microservices">
<h3>Global Microservices<a class="headerlink" href="#global-microservices" title="Permalink to this headline">¶</a></h3>
<p>Global microservices do not handle tenant-specific tasks. These services handle aspects such
as instance-wide user management and tenant management that are not specific to individual
system tenants. The Web/REST microservice that supports the administrative application and
REST services is a global service, since supporting a separate web container for each tenant
would be cumbersome and would break existing SiteWhere 1.x applications. There is also a
global instance management microservice that monitors various aspects of the entire instance
and reports updates to the individual microservces via Kafka.</p>
</div>
<div class="section" id="multitenant-microservices">
<h3>Multitenant Microservices<a class="headerlink" href="#multitenant-microservices" title="Permalink to this headline">¶</a></h3>
<p>Most of the SiteWhere 2.0 services are multitenant microservices which delegate traffic
to tenant engines that do the actual processing. For instance, the inbound processing microservice
actually consists of many inbound processing tenant engines, each of which is configured separately
and can be started/stopped/reconfigured without affecting other tenant engines.</p>
<p>The new approach to tenant engines changes the dynamics of SiteWhere event processing. It is now
possible to stop a single tenant engine without the need for stopping tenant engines running in
other microservices. For instance, inbound processing for a tenant can be stopped
and reconfigured while the rest of the tenant pipeline continues processing.
Since new events can be allowed to stack up in Kafka, the tenant engine can be stopped, reconfigured,
and restarted, then resume where it left off with no data loss.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="features.html" class="btn btn-neutral float-right" title="New Platform 2.0 Features" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="SiteWhere Platform Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, SiteWhere LLC.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.0.EA1 Community Edition',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>