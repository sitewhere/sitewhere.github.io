

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Instance Management Microservice &mdash; SiteWhere 2.0.RC1 Community Edition documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/css/sitewhere.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="SiteWhere 2.0.RC1 Community Edition documentation" href="../../index.html"/>
        <link rel="up" title="Microservice Runtime Guide" href="index.html"/>
        <link rel="next" title="SiteWhere Development Guide" href="../../development/index.html"/>
        <link rel="prev" title="Microservice Runtime Guide" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> SiteWhere
          

          
          </a>

          
            
            
              <div class="version">
                2.0.RC1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">SiteWhere Platform</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../architecture.html">SiteWhere Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features.html">New Platform 2.0 Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microservice-overview.html">Microservices Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Microservice Runtime Guide</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Instance Management Microservice</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#microservice-dependencies">Microservice Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#zookeeper-bootstrapping">Zookeeper Bootstrapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="#instance-templates">Instance Templates</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">SiteWhere Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/index.html">SiteWhere Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userguide/index.html">SiteWhere User Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SiteWhere</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">SiteWhere Platform</a> &raquo;</li>
        
          <li><a href="index.html">Microservice Runtime Guide</a> &raquo;</li>
        
      <li>Instance Management Microservice</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <a class="reference internal image-reference" href="../../_images/sitewhere-with-tagline.png"><img alt="SiteWhere" class="align-center" src="../../_images/sitewhere-with-tagline.png" style="width: 560.0px; height: 177.1px;" /></a>
<hr class="docutils" />
<div class="section" id="instance-management-microservice">
<h1>Instance Management Microservice<a class="headerlink" href="#instance-management-microservice" title="Permalink to this headline">¶</a></h1>
<p>The instance management microservice is used to bootstrap a SiteWhere instance and is
required to be present when starting an uninitialized SiteWhere instance. The instance
management microservice does not currently provide any services other than system
bootstrapping, so it may be left out of instances that have already been configured.</p>
<div class="section" id="microservice-dependencies">
<h2>Microservice Dependencies<a class="headerlink" href="#microservice-dependencies" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>User Management</strong> - Required in order to bootstrap default system users based on the
chosen instance template.</li>
<li><strong>Tenant Management</strong> - Required in order to bootstrap default system tenants based on
the chosen instance template.</li>
</ul>
</div>
<div class="section" id="zookeeper-bootstrapping">
<h2>Zookeeper Bootstrapping<a class="headerlink" href="#zookeeper-bootstrapping" title="Permalink to this headline">¶</a></h2>
<p>The instance management microservice is responsible for connecting to Zookeeper and
creating the base tree where all other configuration data for the instance is stored.</p>
<div class="section" id="zookeeper-connectivity">
<h3>Zookeeper Connectivity<a class="headerlink" href="#zookeeper-connectivity" title="Permalink to this headline">¶</a></h3>
<p>All SiteWhere microservices rely on Zookeeper to provide configuration information
at runtime. The microservices use the following environment variables and default
values for connecting to Zookeeper:</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="46%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Environment Variable</th>
<th class="head">Default Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Zookeeper Host</td>
<td>sitewhere.zookeeper.host</td>
<td>localhost</td>
</tr>
<tr class="row-odd"><td>Zookeeper Port</td>
<td>sitewhere.zookeeper.port</td>
<td>2181</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Docker Compose configuration should pass a Zookeeper hostname that can be resolved
on the Docker network that the microservices are attached to. Note that the Zookeeper
environment variables must be passed for every microservice.</p>
</div>
</div>
<div class="section" id="zookeeper-tree-settings">
<h3>Zookeeper Tree Settings<a class="headerlink" href="#zookeeper-tree-settings" title="Permalink to this headline">¶</a></h3>
<p>Once connected to Zookeeper, the instance management microservice is responsible
for creating the base of the instance Zookeeper tree based on the following
variables and default values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="45%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Environment Variable</th>
<th class="head">Default Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Product Id</td>
<td>sitewhere.product.id</td>
<td>sitewhere</td>
</tr>
<tr class="row-odd"><td>Instance Id</td>
<td>sitewhere.instance.id</td>
<td>sitewhere1</td>
</tr>
</tbody>
</table>
<p>For the default system values, the Zookeeper tree will be rooted at <code class="docutils literal"><span class="pre">sitewhere/sitewhere1</span></code>
and all other instance configuration data will be located relative to that root. If
multiple instances of SiteWhere are to be run concurrently using the same Zookeeper cluster,
they should provide different values for <code class="docutils literal"><span class="pre">sitewhere.instance.id</span></code> so that the configuration data
does not overlap. This can be accomplished by setting the <code class="docutils literal"><span class="pre">sitewhere.instance.id</span></code>
environment variable via the Docker Compose configuration.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All of the microservices intended to run in the same instance should use the same
values for <code class="docutils literal"><span class="pre">sitewhere.product.id</span></code> and <code class="docutils literal"><span class="pre">sitewhere.instance.id</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="instance-templates">
<h2>Instance Templates<a class="headerlink" href="#instance-templates" title="Permalink to this headline">¶</a></h2>
<p>An <em>instance template</em> is used to specify the scripts that will be exceuted to populate the
default users and tenants for the instance. A list of instance templates is packaged as part
of the Docker image for the instance management microservice. Each template has a JSON descriptor
that includes a unique id which may be passed if the instance is to be initialized by that
template’s scripts.</p>
<div class="section" id="changing-the-instance-template">
<h3>Changing the Instance Template<a class="headerlink" href="#changing-the-instance-template" title="Permalink to this headline">¶</a></h3>
<p>The following environment variable is used to indicate which template
will be used for initialization:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="46%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Environment Variable</th>
<th class="head">Default Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Instance Template Id</td>
<td>sitewhere.instance.template.id</td>
<td>default</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">default</span></code> template that is packaged in the Docker image loads the default <code class="docutils literal"><span class="pre">admin</span></code> and
<code class="docutils literal"><span class="pre">noadmin</span></code> users normally expected in a new system along with a default tenant based on
the <code class="docutils literal"><span class="pre">mongo</span></code> tenant template and <code class="docutils literal"><span class="pre">construction</span></code> dataset.</p>
</div>
</div>
<div class="section" id="instance-data-boostrapping">
<h3>Instance Data Boostrapping<a class="headerlink" href="#instance-data-boostrapping" title="Permalink to this headline">¶</a></h3>
<p>If no <code class="docutils literal"><span class="pre">bootstrapped</span></code> marker is found in the <code class="docutils literal"><span class="pre">state</span></code> subfolder of Zookeeper for
the instance, the instance management microservice will attempt to use the instance
template to bootstrap the user and tenant data. It waits for the user and tenant
management microservices to start before running the scripts which push data via
the respective APIs.</p>
<p>Once the initialization scripts have run, the instance is considered to be initialized and
a <code class="docutils literal"><span class="pre">bootstrapped</span></code> marker is pushed to Zookeeper to prevent re-running the scripts every
time the instance starts. Removing the marker will cause the instance template data to be
loaded over the existing data, which may cause problems with duplicate key exceptions.</p>
<p>After initialization, instance management does not serve any other role in the system
and may be shut down to conserve resources.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../development/index.html" class="btn btn-neutral float-right" title="SiteWhere Development Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Microservice Runtime Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, SiteWhere LLC.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.0.RC1 Community Edition',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>