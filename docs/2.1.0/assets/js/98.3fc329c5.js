(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{228:function(t,e,a){"use strict";a.r(e);var s=a(1),n=Object(s.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("Seo"),t._v(" "),a("MicroserviceBadge",{attrs:{text:"Multitenant Microservice",type:"multitenant"}}),t._v(" "),a("p",[t._v("The batch operations microservice provides the core APIs and data persistence\nfor managing batch operations for each tenant in a SiteWhere instance. The batch operations\nmodel is empty upon tenant initialization, but may be populated by invoking APIs that\nproduce batch operations (such as batch command invocations).")]),t._v(" "),t._m(1),t._v(" "),a("table",[t._m(2),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[a("router-link",{attrs:{to:"./../instance-management/"}},[t._v("Instance Management")])],1)]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Required to initially bootstrap Zookeeper data.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[a("router-link",{attrs:{to:"./../device-management/"}},[t._v("Device Management")])],1)]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Used to locate device information when resolving batch elements.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[a("router-link",{attrs:{to:"./../event-management/"}},[t._v("Event Management")])],1)]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Used to create command invocation events for batch commands.")])])])]),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),a("p",[t._v("The following REST APIs are served by the "),a("router-link",{attrs:{to:"./../web-rest/"}},[t._v("Web/REST microservice")]),t._v(" backed by the batch\noperations microservice.")],1),t._v(" "),a("table",[t._m(5),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"http://sitewhere.io/docs/2.1.0/api2/#tag/batch-operations",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[t._v("Batch Operation APIs")]),a("OutboundLink")],1)]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("REST API methods for managing batch operations.")])])])]),t._v(" "),t._m(6),t._v(" "),a("p",[t._v("The batch operations microservice includes a gRPC server which listens on a dedicated port\n(9000) and offers high performance access to the batch management APIs. In the default\nconfiguration, the port is only accessible to the other microservices. The batch management\nports may be exposed via load balancer by executing the following Helm command:")]),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),a("p",[t._v("Java stubs are available for accessing the gRPC batch management APIs. The stubs\nmay be included by using the following:")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),t._m(13),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/sitewhere/sitewhere-grpc-api",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[t._v("https://github.com/sitewhere/sitewhere-grpc-api")]),a("OutboundLink")],1)]),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),a("p",[a("a",{attrs:{href:"https://sitewhere.io/schema/sitewhere/microservice/batch-operations/current/batch-operations.xsd",target:"_blank",rel:"noopener noreferrer"}},[t._v("Batch Operations Configuration XML Schema"),a("OutboundLink")],1)]),t._v(" "),t._m(16),t._v(" "),t._m(17),t._m(18),t._v(" "),a("p",[t._v("The following Kafka topics are used to interact with the event processing pipeline.\nFor multitenant microservices, topic names are specific to the tenant whose data\nthey contain and have a standardized format as shown below:")]),t._v(" "),a("MicroserviceBadge",{attrs:{text:"Product Id",type:"multitenant"}}),t._v(". "),a("MicroserviceBadge",{attrs:{text:"Instance Id",type:"multitenant"}}),t._v(". tenant . "),a("MicroserviceBadge",{attrs:{text:"Tenant UUID",type:"multitenant"}}),t._v(". "),a("MicroserviceBadge",{attrs:{text:"Topic Name",type:"multitenant"}}),t._v(" "),a("p",[t._v("For example, a valid topic name might be:")]),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),a("p",[t._v("Each batch operations tenant engine contains a batch operations manager which processes\noperations that are created via the batch management APIs. If multiple instances of the\nbatch operations microservice are running, the batch processing load will be distributed\namongst them.")]),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),a("p",[t._v("If the "),a("code",[t._v("operationType")]),t._v(" of the batch operation is "),a("code",[t._v("BatchCommandInvocation")]),t._v(", the operation is\ntreated as a batch command invocation, which results in a command invocation event being\ngenerated for each of the batch elements. Based on metadata stored with the parent operation,\nboth the targeted device and the command to be invoked are looked up via the\n"),a("router-link",{attrs:{to:"./../device-management/"}},[t._v("device management")]),t._v(" APIs. After verifying that a device exists\nfor the token and that it has an active assignment, a new device command invocation event\nis created via the "),a("router-link",{attrs:{to:"./../event-management/"}},[t._v("event management")]),t._v(" APIs. The created command invocation\nwill be picked up by the "),a("router-link",{attrs:{to:"./../inbound-processing/"}},[t._v("inbound processing")]),t._v(" service and forwarded\nto the "),a("router-link",{attrs:{to:"./../command-delivery/"}},[t._v("command delivery")]),t._v(" service for delivery to the device.")],1)],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"batch-operations-microservice"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#batch-operations-microservice","aria-hidden":"true"}},[this._v("#")]),this._v(" ðŸ“– Batch Operations Microservice")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"microservice-dependencies"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#microservice-dependencies","aria-hidden":"true"}},[this._v("#")]),this._v(" Microservice Dependencies")])},function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[this._v("Microservice")]),this._v(" "),e("th",{staticStyle:{"text-align":"left"}},[this._v("Dependency")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"available-apis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#available-apis","aria-hidden":"true"}},[this._v("#")]),this._v(" Available APIs")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"rest-apis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rest-apis","aria-hidden":"true"}},[this._v("#")]),this._v(" REST APIs")])},function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[this._v("API")]),this._v(" "),e("th",{staticStyle:{"text-align":"left"}},[this._v("Description")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"grpc-apis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#grpc-apis","aria-hidden":"true"}},[this._v("#")]),this._v(" gRPC APIs")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("helm upgrade -set batch_operations.service.type=LoadBalancer")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"grpc-clients"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#grpc-clients","aria-hidden":"true"}},[this._v("#")]),this._v(" gRPC Clients")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"gradle"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gradle","aria-hidden":"true"}},[this._v("#")]),this._v(" Gradle")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-groovy extra-class"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[t._v("compile group"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'com.sitewhere'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'sitewhere-grpc-batch-management'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" version"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'2.0.4'")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"maven"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#maven","aria-hidden":"true"}},[this._v("#")]),this._v(" Maven")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("com.sitewhere"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("sitewhere-grpc-batch-management"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("2.0.4"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("See the following repository for\nthe "),e("code",[this._v("proto")]),this._v(" definitions if bindings other than Java are needed:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuration")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"configuration-schema"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration-schema","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuration Schema")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"example-configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#example-configuration","aria-hidden":"true"}},[this._v("#")]),this._v(" Example Configuration")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{attrs:{class:"token prolog"}},[t._v('<?xml version="1.0" encoding="UTF-8"?>')]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("beans")]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("xmlns")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.springframework.org/schema/beans"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n\t"),a("span",{attrs:{class:"token attr-name"}},[a("span",{attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("ds")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://sitewhere.io/schema/sitewhere/microservice/common/datastore"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n\t"),a("span",{attrs:{class:"token attr-name"}},[a("span",{attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("xsi")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.w3.org/2001/XMLSchema-instance"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[a("span",{attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("context")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.springframework.org/schema/context"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n\t"),a("span",{attrs:{class:"token attr-name"}},[a("span",{attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("bop")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://sitewhere.io/schema/sitewhere/microservice/batch-operations"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n\t"),a("span",{attrs:{class:"token attr-name"}},[a("span",{attrs:{class:"token namespace"}},[t._v("xsi:")]),t._v("schemaLocation")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("\n           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd\n           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd\n           http://sitewhere.io/schema/sitewhere/microservice/common/datastore http://sitewhere.io/schema/sitewhere/microservice/common/current/datastore-common.xsd\n           http://sitewhere.io/schema/sitewhere/microservice/batch-operations http://sitewhere.io/schema/sitewhere/microservice/batch-operations/current/batch-operations.xsd"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("\x3c!-- Allow property placeholder substitution --\x3e")]),t._v("\n\t"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{attrs:{class:"token namespace"}},[t._v("context:")]),t._v("property-placeholder")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n\n\t"),a("span",{attrs:{class:"token comment"}},[t._v("\x3c!-- Batch Operations --\x3e")]),t._v("\n\t"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{attrs:{class:"token namespace"}},[t._v("bop:")]),t._v("batch-operations")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n\t\t"),a("span",{attrs:{class:"token comment"}},[t._v("\x3c!-- Use global MongoDB tenant configuration --\x3e")]),t._v("\n\t\t"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{attrs:{class:"token namespace"}},[t._v("ds:")]),t._v("device-management-datastore")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t\t\t"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{attrs:{class:"token namespace"}},[t._v("ds:")]),t._v("mongodb-datastore-reference")]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("tenant"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n\t\t"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),a("span",{attrs:{class:"token namespace"}},[t._v("ds:")]),t._v("device-management-datastore")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n\t\t"),a("span",{attrs:{class:"token comment"}},[t._v("\x3c!-- Batch operation manager configuration --\x3e")]),t._v("\n\t\t"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{attrs:{class:"token namespace"}},[t._v("bop:")]),t._v("batch-operation-manager")]),t._v("\n\t\t\t"),a("span",{attrs:{class:"token attr-name"}},[t._v("throttleDelayMs")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n\n\t"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),a("span",{attrs:{class:"token namespace"}},[t._v("bop:")]),t._v("batch-operations")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("beans")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"kafka-topics"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kafka-topics","aria-hidden":"true"}},[this._v("#")]),this._v(" Kafka Topics")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("sitewhere.sitewhere1.tenant.53daebb2-8b54-4031-a4b9-29e3fc04b4be.unprocessed-batch-operations")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Topic Name")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Relation")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Content")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("unprocessed-batch-operations")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Producer")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Batch operations which have been persisted but not processed.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("unprocessed-batch-elements")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Producer")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Batch elements which have been persisted but not processed.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("failed-batch-elements")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Producer")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Batch elements which failed processing.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("unprocessed-batch-operations")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Consumer")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Batch operations which have been persisted but not processed.")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("unprocessed-batch-elements")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Consumer")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Batch elements which have been persisted but not processed.")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"runtime-behavior"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#runtime-behavior","aria-hidden":"true"}},[this._v("#")]),this._v(" Runtime Behavior")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"batch-operation-manager"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#batch-operation-manager","aria-hidden":"true"}},[this._v("#")]),this._v(" Batch Operation Manager")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"creation-of-batch-operations"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creation-of-batch-operations","aria-hidden":"true"}},[this._v("#")]),this._v(" Creation of Batch Operations")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The batch operations manager for each tenant acts as both a producer and consumer of batch\noperations. When a batch operation is persisted via the batch management APIs, the basic\noperation information is stored, then the operation is pushed onto the unprocessed operations\ntopic along with the list of device tokens the operation targets. At this point, the status\nof the batch operation is "),e("code",[this._v("Unprocessed")]),this._v(". The unprocessed batch operations topic is keyed\nwith the batch operation id so that operations are always processed by the same consumer.\nThis prevents race conditions where two batch operation tenant engines for the same tenant\nattempt to process the same batch operation concurrently.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"initialization-of-batch-operations"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#initialization-of-batch-operations","aria-hidden":"true"}},[this._v("#")]),this._v(" Initialization of Batch Operations")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("p",[t._v("The batch operations manager has a consumer for unprocessed operations which takes the\noperation information and the list of device tokens is applies to, then creates batch\nelements for each of the device tokens. The status of the batch operation is first updated\nto "),a("code",[t._v("Initializing")]),t._v(", then batch elements are persisted with a status of "),a("code",[t._v("Unprocessed")]),t._v(" and\npushed onto the unprocessed batch elements topic. Depending on throttling settings in\nthe batch operations manager, a delay may be introduced in the creation of batch elements\nto prevent overloading the database with a large number of elements in a short period of\ntime. If all of the batch elements are created and pushed successfully, the batch operation\nstatus is updated to "),a("code",[t._v("InitializedSuccessfully")]),t._v(". Otherwise, the operation status is updated\nto "),a("code",[t._v("InitializedWithErrors")]),t._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"processing-of-batch-elements"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#processing-of-batch-elements","aria-hidden":"true"}},[this._v("#")]),this._v(" Processing of Batch Elements")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The batch operations manager has a consumer for unprocessed batch elements, which takes\nthe individual elements for a batch operation and processes them. Note that the batch elements\nare keyed by device token, so elements for a given device will always be processed by the\nsame batch operations manager. The batch element is first updated with a status of\n"),e("code",[this._v("Processing")]),this._v(", then the processing is handed off to a batch operation handler based on\nthe "),e("code",[this._v("operationType")]),this._v(" field on the parent operation. For instance, a handler is registered\nfor processing batch command invocations and is triggered if the operation type is\n"),e("code",[this._v("BatchCommandInvocation")]),this._v(". The batch operation manager is designed to support many batch\noperation types, but currently only handles batch command invocations.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"processing-of-batch-command-invocations"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#processing-of-batch-command-invocations","aria-hidden":"true"}},[this._v("#")]),this._v(" Processing of Batch Command Invocations")])}],!1,null,null,null);n.options.__file="README.md";e.default=n.exports}}]);